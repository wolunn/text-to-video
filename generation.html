<!DOCTYPE html>
<html  class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<title>Birthday Sister Images</title>
	<meta name="description" content="Generate Happy Birthday Sister Images using AI, which can be created by combining real photos with AI to create the image you desire.">
	<link rel="icon" href="assets/img/title.png" type="image/gif" sizes="16x16">
	<link rel="icon" href="assets/img/title.png" type="image/gif" sizes="18x18">
	<link rel="icon" href="assets/img/title.png" type="image/gif" sizes="20x20">

	<link rel="stylesheet" href="assets/css/bootstrap.min.css">
	<link rel="stylesheet" href="assets/css/bootstrap-icons.css">
	<link rel="stylesheet" href="assets/css/fontawesome.all.min.css">
	<link rel="stylesheet" href="assets/css/owl.carousel.min.css">
	<!--<link rel="stylesheet" href="assets/css/owl.theme.default.min.css">-->
	<!--<link rel="stylesheet" href="assets/css/animate.css">-->
	<!--<link rel="stylesheet" href="assets/css/magnific-popup.css">-->
	<link rel="stylesheet" href="assets/css/normalize.css">
	<link rel="stylesheet" href="style.css">
	<!--<link rel="stylesheet" href="assets/css/responsive.css">-->
	<link rel="stylesheet" href="assets/css/wwj.css">
	<script src="assets/js/popper.min.js"></script>
	<style>
		#deleteButton {
			position: absolute;
			top: 0;
			right: 0;
			cursor: pointer;
			background-color: #f3b0b0;
			color: #fff;
			border: none;
			border-radius: 4px;
			transition: background-color 0.3s ease;
		}
		.button-row {
			display: flex;
			align-items: center;
		}

		#fileInput {
			display: none;
		}

		label[for="fileInput"] {
			background-color: #f3b0b0;
			color: #fff;
			padding: 10px 20px;
			border-radius: 4px;
			cursor: pointer;
			transition: background-color 0.3s ease;
		}

		label[for="fileInput"]:hover {
			background-color: #4a77f4;
		}

		.prompt-label {
			margin: 0 10px;
			font-weight: bold;
			color: #333;
		}

		.suggestion-button {
			background-color: #f3b0b0;
			color: #fff;
			border: none;
			padding: 10px 20px;
			border-radius: 4px;
			cursor: pointer;
			transition: background-color 0.3s ease;
		}

		.suggestion-button:not(:last-child) {
			margin-right: 10px;
		}

		.suggestion-button:hover {
			background-color: #4a77f4;
		}

		#myButton:hover {
			background-color: #4a77f4;
		}
		#chooseImg:hover {
			background-color: #4a77f4;
		}
		#deleteButton:hover {
			color: #4a77f4;
		}
	</style>
</head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-KV2M1DEQ0L"></script>
<script>
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());

	gtag('config', 'G-KV2M1DEQ0L');
</script>
<body style="background-color:#F7F7F7">
	<section class="hero-area-wwj" style="background-color:#F7F7F7">
		<div class="container">
			<div class="row">
				<div class="col-lg-8 offset-lg-2 text-center">
					<div class="hero-caption">
						<h1 id="titlew">AI-Generated Birthday Images</h1>
						<div class="h-search-form-wwj">
							<form action="#">
								<input type="search" name="search" id="myInput" placeholder="Type Your Keywords . . .">
								<button id="myButton">Generate</button>
							</form>
						</div>
						<div style="height: 70px" class="button-row">
							<span class="prompt-label">prompt: </span>
							<button class="suggestion-button" onclick="addSuggestion('birthday')">birthday</button>
							<button class="suggestion-button" onclick="addSuggestion('warm')">warm</button>
							<button class="suggestion-button" onclick="addSuggestion('happy')">happy</button>
							<button class="suggestion-button" onclick="addSuggestion('blessing')">blessing</button>
						</div>
						<div style=" height:120px;position: relative;max-width:260px;border-radius: 8px;display: flex; ">
							<div style="flex: 1;display: flex;">
								<label id="chooseImg" for="fileInput" style="height:45px;text-align: left;padding:10px;color: #fff;border: none;border-radius: 4px;">choose a photo</label>
							</div>
							<div style="width: 100px;">
								<input type="file" id="fileInput" accept="image/*" style="display: none;"/>
								<img id="previewImage" src="" alt="preview" style="max-width: 100px; display: none;" />
								<button id="deleteButton" style="display: none;">delete</button>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</section>
	<!-- Start Latest Product Area -->
	<section class="latest-product-area section section-bg">
		<div class="container">
			<div class="row"><span id="progress"></span></div>
			<div class="row" style="height: 5px"></div>
			<div class="row">
				<!-- Category -->
				<div class="row l-product-recent-theme portF ">
					<!-- Single -->
					<div class="col-lg-3 col-md-6 mb-30 mix ">
						<div class="product-item">
							<!-- thumbnail -->
							<div class="thumbnail">
								<a>
									<img id="myImage1" src="assets/img/loading.jpg" alt="Happy birthday sister images">
								</a>
								<a  id="myLink1" class="button-5" style="display:none; position: absolute;bottom: 10px;right: 10px;border: none;cursor: pointer;" href="assets/img/loading.jpg" download="image001.jpg"><i class="fas fa-download"></i></a>
							</div>
						</div>
					</div>
					<!-- Single -->
					<div class="col-lg-3 col-md-6 mb-30 mix ">
						<div class="product-item">
							<!-- thumbnail -->
							<div class="thumbnail">
								<a>
									<img id="myImage2" src="assets/img/loading.jpg" alt="Happy birthday sister images">
								</a>
								<a id="myLink2" class="button-5" style="display:none; position: absolute;bottom: 10px;right: 10px;border: none;cursor: pointer;" href="assets/img/loading.jpg" download="image002.jpg"><i class="fas fa-download"></i></a>
							</div>
						</div>
					</div>
					<!-- Single -->
					<div class="col-lg-3 col-md-6 mb-30 mix ">
						<div class="product-item">
							<!-- thumbnail -->
							<div class="thumbnail">
								<a>
									<img id="myImage3" src="assets/img/loading.jpg" alt="Happy birthday sister images!">
								</a>
								<a id="myLink3" class="button-5" style="display:none; position: absolute;bottom: 10px;right: 10px;border: none;cursor: pointer;" href="assets/img/loading.jpg" download="image003.jpg"><i class="fas fa-download"></i></a>
							</div>
						</div>
					</div>
					<!-- Single -->
					<div class="col-lg-3 col-md-6 mb-30 mix ">
						<div class="product-item">
							<!-- thumbnail -->
							<div class="thumbnail">
								<a>
									<img id="myImage4" src="assets/img/loading.jpg" alt="Happy birthday sister images">
								</a>
								<a id="myLink4" class="button-5" style="display:none; position: absolute;bottom: 10px;right: 10px;border: none;cursor: pointer;" href="assets/img/loading.jpg" download="image004.jpg"><i class="fas fa-download"></i></a>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</section>
	<!-- End Footer Area -->
	<div class="scroll-area">
       <i class="bi bi-arrow-up"></i>
    </div>
    <!-- Js File -->
    <!--<script src="assets/js/modernizr.min.js"></script>-->
    <script src="assets/js/jquery-3.6.0.min.js"></script>
    <!--<script src="assets/js/popper.min.js"></script>-->
    <script src="assets/js/bootstrap.min.js"></script>
    <script src="assets/js/owl.carousel.min.js"></script>
    <script src="assets/js/jquery.magnific-popup.min.js"></script>
    <script src="assets/js/mixitup.min.js"></script>
    <!--<script src="assets/js/jquery.waypoints.min.js"></script>-->
	<script src="assets/js/jquery.counterup.min.js"></script>
    <script src="assets/js/wow.min.js"></script>
    <<!--script src="assets/js/ajax-form.js"></script>-->
    <script src="assets/js/mobile-menu.js"></script>
    <script src="assets/js/script.js"></script>
	<script>
		let task ;
		let intervalId; // 用于存储定时器ID

		function generate() {
			if($('#myInput').val().trim() == ''){
				alert('input is not null');
				return
			}

			resertImage();
			$('#myButton').prop('disabled', true);
			$('#myInput').prop('disabled', true);
			$('#myButton').css('background-color', '#808080');
			$('#progress').text("Working on creating a graphic (0%)");
			$.ajax({
				url: "/prod-api/mj/submit/imagine", // 请替换为您的后台接口的URL
				type: "POST",
				data: JSON.stringify({
					prompt: $('#myInput').val(),
				}),
				headers:{
					token: 'eyJhbGciOiJIUzUxMiJ9.eyJ1c2VyX2lkIjozfQ.UNqVwZUbGPQVsU-WY2TNTmswvZQn-LsLfHCeYB2-5Wt5niQo3VS2xvt-MJzwJ1r1wsHOchWfZ9ErB7PA1cwZJQ'
				},
				contentType: 'application/json', // 设置请求头为JSON格式
				success: function (res) {
					task = res.data.result;
					startRequest();
				},
				error: function () {
					// 请求失败时的处理
				}
			});
		}

		function startRequest() {
			// 每隔2秒发出请求
			intervalId = setInterval(setImage, 2500);
		}

		function stopRequest() {
			// 停止定时器
			clearInterval(intervalId);
		}

		function setImage() {
			$.ajax({
				url: "/prod-api/mj/getInfo?id="+task, // 请替换为您的后台接口的URL
				type: "GET",
				headers:{
					token: 'eyJhbGciOiJIUzUxMiJ9.eyJ1c2VyX2lkIjozfQ.UNqVwZUbGPQVsU-WY2TNTmswvZQn-LsLfHCeYB2-5Wt5niQo3VS2xvt-MJzwJ1r1wsHOchWfZ9ErB7PA1cwZJQ'
				},
				contentType: 'application/json', // 设置请求头为JSON格式
				success: function (res) {
					let obj = res.data;
					$('#progress').text("Working on creating a graphic ("+decreaseProgress(obj.progress)+")");
					if(obj.progress == "100%" && isConditionMet(obj)){
						let index = 1;
						for (const key in obj) {
							if (typeof obj[key] === 'object' && obj[key].hasOwnProperty('progress') && obj[key].progress == '100%') {
								$('#myImage'+index).attr('src', obj[key].imageUrl);
								$('#myLink'+index).attr('href', obj[key].imageUrl);
								$('#myLink'+index).css('display', 'inline-block');
								index++;
							}
						}
						stopRequest();
						increasePercentage();
					}
				},
				error: function () {
					// 请求失败时的处理
					clearInterval(intervalId);
				}
			});
		}

		// 判断数组是否满足条件
		function isConditionMet(obj) {
			// 检查对象属性个数是否为5
			const propCount = Object.keys(obj).length;
			if (propCount !== 5) {
				return false;
			}

			// 统计具有 progress 属性为 100% 的属性个数
			let progressCount = 0;

			for (const key in obj) {
				if (obj.hasOwnProperty(key)) {
					if (typeof obj[key] === 'object' && obj[key].hasOwnProperty('progress') && obj[key].progress == "100%") {
						progressCount++;
					}
				}
			}
			// 检查 progressCount 是否为4
			return progressCount === 4;
		}

		function resertImage(){
			for (let i = 1; i < 5; i++) {
				$('#myImage'+i).attr('src', "assets/img/loading.gif");
				$('#myLink'+i).attr('href', "assets/img/loading.gif");
				$('#myLink'+i).css('display', 'none');
			}
		}

		function decreaseProgress(progressString) {
			// 如果输入为空值或 null，则返回 "0%"
			if (!progressString) {
				return "0%";
			}

			// 将字符串转换为数字，去除百分号
			let progress = parseFloat(progressString.replace('%', ''));

			// 按比例缩减为80%
			progress *= 0.85;

			// 确保结果没有小数点，使用 parseInt 四舍五入
			progress = parseInt(progress);

			// 将进度转换回字符串形式并添加百分号
			return progress + '%';
		}

		function increasePercentage() {
			let percentage = 85;
			const finalPercentage = 100;

			const intervalId = setInterval(function () {

				if (percentage >= finalPercentage) {
					clearInterval(intervalId); // 停止定时器
					$('#myInput').prop('disabled', false);
					$('#myButton').prop('disabled', false);
					$('#myButton').css('background-color', '#f3b0b0f2');
					$('#chooseImg').prop('disabled', false);
					$('#chooseImg').css('background-color', '#f3b0b0f2');
					$('#deleteButton').prop('disabled', false);
					$('#deleteButton').css('background-color', '#f3b0b0f2');
					$('.suggestion-button').prop('disabled', false);
					$('.suggestion-button').css('background-color', '#f3b0b0f2');
					$('#progress').text("Working on creating a graphic ("+percentage+"%)");
				} else {
					percentage += 1; // 增加1%
					$('#progress').text("Working on creating a graphic ("+percentage+"%)");
				}
			}, 1000); // 每隔1秒执行一次
		}


		$(document).ready(function() {
			var uploadedImage = null;

			// 当选择文件时触发
			$("#fileInput").change(function() {
				var file = this.files[0];

				if (file) {
					if (file.size <= 10485760) { // 10MB限制
						var reader = new FileReader();
						reader.onload = function(e) {
							uploadedImage = e.target.result;
							$("#previewImage").attr("src", uploadedImage).show();
							$("#deleteButton").show();
							/*$("#uploadButton").prop("disabled", false);*/
						};
						reader.readAsDataURL(file);
					} else {
						alert("文件大小超过10MB限制");
						resetImageInput();
					}
				}
			});

			// 点击删除按钮时触发
			$("#deleteButton").click(function() {
				resetImageInput();
			});
			// 点击上传按钮时触发
			$("#myButton").click(function() {
				if($('#myInput').val().trim() == ''){
					alert('input is not null');
					return
				}

				resertImage();
				$('#myInput').prop('disabled', true);
				$('#myButton').prop('disabled', true);
				$('#myButton').css('background-color', '#808080');
				$('#chooseImg').prop('disabled', true);
				$('#chooseImg').css('background-color', '#808080');
				$('#deleteButton').prop('disabled', true);
				$('#deleteButton').css('background-color', '#808080');
				$('.suggestion-button').prop('disabled', true);
				$('.suggestion-button').css('background-color', '#808080');

				$('#progress').text("Working on creating a graphic (0%)");

				if (uploadedImage) {
					var base64Array = [uploadedImage];
					var promptValue = $('#myInput').val();
					// 此处将base64Array和promptValue发送到后台
					sendToBackend(base64Array, promptValue);
				}else{
					var base64Array = [];
					var promptValue = $('#myInput').val();
					// 此处将base64Array和promptValue发送到后台
					sendToBackend(base64Array, promptValue);
				}
			});

			// 重置文件输入字段
			function resetImageInput() {
				$("#fileInput").val("");
				$("#previewImage").attr("src", "").hide();
				$("#deleteButton").hide();
				/*$("#uploadButton").prop("disabled", true);*/
				uploadedImage = null;
			}

			// 向后台发送数据
			function sendToBackend(base64Array, promptValue) {
				// 创建一个包含base64Array和prompt的对象
				var requestData = {
					base64Array: base64Array,
					prompt: promptValue
				};

				$.ajax({
					url: "/prod-api/mj/submit/imagine", // 替换为后台上传接口URL
					type: "POST",
					data: JSON.stringify(requestData),
					contentType: "application/json",
					headers:{
						token: 'eyJhbGciOiJIUzUxMiJ9.eyJ1c2VyX2lkIjozfQ.UNqVwZUbGPQVsU-WY2TNTmswvZQn-LsLfHCeYB2-5Wt5niQo3VS2xvt-MJzwJ1r1wsHOchWfZ9ErB7PA1cwZJQ'
					},
					success: function(response) {
						if(response.data.code == 1){
							task = response.data.result;
							startRequest();
						}else {
							alert("error!")
						}

					},
					error: function(error) {
						// 处理上传失败的回调
						alert("上传失败：" + error.statusText);
						resetImageInput();
					}
				});
			}
		});
		function addSuggestion(suggestion) {
			var myInput = document.getElementById('myInput');
			var currentText = myInput.value;
			if (currentText) {
				myInput.value = currentText + ';' + suggestion;
			} else {
				myInput.value = suggestion;
			}
		}
	</script>
</body>
</html>
